---
alwaysApply: true
---

# Automation Suggestions - Intelligent Self-Healing Patterns

> **Suggestion-first automation for velocity without losing human oversight**

This rule defines patterns for the AI to suggest fixes, improvements, and optimizations while maintaining enterprise
quality and human decision-making authority.

## Quick Navigation

- ğŸš€ [Velocity Hub](mdc:.cursor/rules/velocity.mdc) - Start here
- â˜ï¸ [Workers Deployment](mdc:.cursor/rules/workers-deployment.mdc) - Deployment guide
- ğŸ§ª [Testing](mdc:.cursor/rules/testing.mdc) - Testing standards
- ğŸ“˜ [TypeScript](mdc:.cursor/rules/typescript.mdc) - Type patterns
- ğŸ¢ [Enterprise Standards](mdc:.cursor/rules/enterprise-standards.mdc) - Quality standards

## Automation Philosophy

**Suggestion-First Approach:**

- AI detects issues and opportunities
- Provides exact fix with rationale
- Offers copy-paste commands
- Human reviews and applies
- No automatic code changes without explicit request

**Velocity Focus:**

- One-click application when appropriate
- Grouped related fixes
- Prioritize high-impact improvements
- Minimize back-and-forth iterations

## Safe Auto-Suggest Patterns

These patterns are safe to suggest immediately with exact fixes:

### 1. Import Organization

**Pattern Detection:**

```typescript
// âŒ Detected: Disorganized imports
import { MyClass } from "./myClass.js";
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { describe, it, expect } from "bun:test";
```

**Suggested Fix:**

```typescript
// âœ… Suggested: Organized imports
import { describe, it, expect } from "bun:test";
import { Server } from "@modelcontextprotocol/sdk/server/index.js";

import { MyClass } from "./myClass.js";
```

**AI Response Template:**

```
ğŸ”§ Import Organization Improvement

Detected: Imports not following standard order
- Bun built-ins should come first
- External packages second
- Internal modules last

ğŸ“ Quick Fix:
[Show reorganized imports]

âš¡ Apply: Would you like me to reorganize these imports?
```

### 2. Unused Imports

**Pattern Detection:**

```typescript
// âŒ Detected: Unused imports
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { CallToolRequestSchema } from "@modelcontextprotocol/sdk/types.js"; // unused
```

**Suggested Fix:**

```typescript
// âœ… Remove unused import
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
```

**AI Response Template:**

```
ğŸ”§ Unused Import Detected

Import not used in file: CallToolRequestSchema

ğŸ“ Quick Fix: Remove the unused import

âš¡ Apply: Remove this import?
```

### 3. Missing File Extensions

**Pattern Detection:**

```typescript
// âŒ Detected: Missing .js extension
import { helper } from "./helper";
```

**Suggested Fix:**

```typescript
// âœ… Add .js extension (required for ESM)
import { helper } from "./helper.js";
```

**AI Response Template:**

```
ğŸ”§ Missing File Extension

ES modules require explicit .js extensions in imports

ğŸ“ Quick Fix: Add .js to import path

âš¡ Apply: Update import statement?
```

### 4. Formatting Inconsistencies

**Pattern Detection:**

- Inconsistent indentation
- Missing semicolons (if configured)
- Trailing whitespace
- Missing newlines at EOF

**Suggested Fix:**

```
ğŸ”§ Formatting Issues Detected

Run: bun run format

This will fix:
- Indentation (2 spaces)
- Line length (120 chars)
- Trailing whitespace
- End-of-file newlines

âš¡ Quick Fix: Run formatter now?
```

## Suggest-First Patterns

These patterns require human review before applying:

### 1. Type Inference Improvements

**Pattern Detection:**

```typescript
// ğŸŸ¡ Opportunity: Explicit type could be inferred
const result: string = processData();

// Or: Missing return type
function processData() {
  return "result";
}
```

**Suggested Improvement:**

```typescript
// âœ… Option 1: Remove redundant type
const result = processData(); // Type inferred

// âœ… Option 2: Add return type
function processData(): string {
  return "result";
}
```

**AI Response Template:**

```
ğŸ’¡ Type Inference Opportunity

Current: Redundant type annotation on variable
Suggestion: Remove explicit type (inferred as string)

OR

Current: Missing return type on function
Suggestion: Add explicit return type

ğŸ“ Rationale: Improves code clarity and type safety

ğŸ¤” Review: Which approach do you prefer?
```

### 2. Error Handling Enhancements

**Pattern Detection:**

```typescript
// ğŸŸ¡ Opportunity: Unhandled promise
async function fetchData() {
  const data = await fetch(url);
  return data.json();
}
```

**Suggested Improvement:**

```typescript
// âœ… Add error handling
async function fetchData() {
  try {
    const data = await fetch(url);
    return data.json();
  } catch (error) {
    console.error("Fetch failed:", error);
    throw new Error("Failed to fetch data");
  }
}
```

**AI Response Template:**

```
ğŸ’¡ Error Handling Enhancement

Detected: Async function without error handling
Risk: Unhandled promise rejections

ğŸ“ Suggested Pattern:
[Show try-catch implementation]

ğŸ’­ Consider: Should this throw or return error Result?

ğŸ¤” Review: Apply error handling?
```

### 3. Test Coverage Gaps

**Pattern Detection:**

```typescript
// ğŸŸ¡ Detected: Function without tests
export function calculateTotal(items: Item[]): number {
  return items.reduce((sum, item) => sum + item.price, 0);
}

// Edge cases not tested:
// - Empty array
// - Negative prices
// - Non-numeric prices
```

**Suggested Tests:**

```typescript
describe("calculateTotal", () => {
  it("should return 0 for empty array", () => {
    expect(calculateTotal([])).toBe(0);
  });

  it("should handle negative prices", () => {
    expect(calculateTotal([{ price: -10 }])).toBe(-10);
  });

  it("should sum multiple items", () => {
    const items = [{ price: 10 }, { price: 20 }];
    expect(calculateTotal(items)).toBe(30);
  });
});
```

**AI Response Template:**

```
ğŸ’¡ Test Coverage Gap

Function: calculateTotal
Current Coverage: 0%
Missing Tests:
- Empty array case
- Negative values
- Multiple items

ğŸ“ Suggested Tests:
[Show test implementation]

ğŸ¤” Review: Add these test cases?
```

### 4. `any` Type Replacements

**Pattern Detection:**

```typescript
// ğŸŸ¡ Detected: any type usage
function processData(input: any) {
  return input.value;
}
```

**Suggested Improvement:**

```typescript
// âœ… Option 1: Use unknown + type guard
function processData(input: unknown): string {
  if (typeof input !== "object" || input === null) {
    throw new Error("Invalid input");
  }
  const data = input as Record<string, unknown>;
  if (typeof data.value !== "string") {
    throw new Error("Invalid value type");
  }
  return data.value;
}

// âœ… Option 2: Define interface
interface DataInput {
  value: string;
}

function processData(input: DataInput): string {
  return input.value;
}
```

**AI Response Template:**

```
ğŸ’¡ Type Safety Improvement

Detected: any type (reduces type safety)
Options:
1. Use unknown + type guards (runtime validation)
2. Define explicit interface (compile-time validation)

ğŸ“ Recommendation: Option 1 for external data, Option 2 for internal APIs

ğŸ¤” Review: Which approach fits your use case?
```

## Deployment Readiness Checks

Before deployment, the AI will validate:

### Pre-Deployment Checklist Validation

```
ğŸš€ Deployment Readiness Check

Running automated validations...

âœ… Tests: All passing (95% coverage)
âœ… Linting: No errors
âœ… TypeScript: Type check passed
âœ… Formatting: Code formatted
âš ï¸ Workers Compatibility: Potential issue detected
âŒ Environment Variables: Missing documentation

ğŸ“‹ Issues Found:

1. Workers Compatibility Warning:
   - File: src/index.ts:45
   - Issue: Using Bun.file() (not Workers-compatible)
   - Suggestion: Use Workers APIs or R2 for files
   - Fix: See [Workers Deployment](mdc:.cursor/rules/workers-deployment.mdc)

2. Environment Variables:
   - Missing: GITHUB_CLIENT_ID, GITHUB_CLIENT_SECRET
   - Action: Document in README or .env.example
   - Template: [Show environment variable docs template]

ğŸ¤” Review: Fix these issues before deploying?
```

### Workers Compatibility Scan

**Pattern Detection:**

```typescript
// âŒ Detected: Bun-only API in Workers build
import { Database } from "bun:sqlite";

const db = new Database("local.db");
```

**Suggested Fix:**

```typescript
// âœ… Workers-compatible alternative
export interface Env {
  DB: D1Database;
}

export default {
  async fetch(request: Request, env: Env) {
    const result = await env.DB.prepare("SELECT * FROM users").all();
  }
};
```

**AI Response Template:**

```
âš ï¸ Workers Compatibility Issue

Detected: bun:sqlite usage
Workers Alternative: Cloudflare D1

ğŸ“ Suggested Pattern:
[Show D1 implementation]

ğŸ“š Reference: [Workers Deployment](mdc:.cursor/rules/workers-deployment.mdc)

ğŸ¤” Review: Convert to D1 for Workers deployment?
```

### Security & Secrets Audit

**Pattern Detection:**

```typescript
// âŒ Detected: Hardcoded secret
const API_KEY = "sk-1234567890abcdef";
```

**Suggested Fix:**

```typescript
// âœ… Use environment variable
export interface Env {
  API_KEY: string;
}

const apiKey = env.API_KEY;
```

**AI Response Template:**

```
ğŸ” Security Issue: Hardcoded Secret

Detected: API key in source code
Risk: Secret exposure in version control

ğŸ“ Required Actions:
1. Move to environment variable
2. Add to wrangler.toml (for config)
3. Use wrangler secret put (for secrets)
4. Remove from git history if committed

âš¡ Urgent: Fix immediately before committing

ğŸ¤” Review: Apply environment variable pattern?
```

## Iterative Improvement Suggestions

Post-deployment optimization opportunities:

### Performance Optimization

**Pattern Detection:**

```typescript
// ğŸŸ¡ Opportunity: Synchronous file reading in loop
for (const file of files) {
  const content = await readFile(file);
  process(content);
}
```

**Suggested Improvement:**

```typescript
// âœ… Parallel processing
const contents = await Promise.all(files.map((file) => readFile(file)));
contents.forEach((content) => process(content));
```

**AI Response Template:**

```
âš¡ Performance Optimization

Detected: Sequential async operations
Opportunity: Process in parallel

ğŸ“Š Impact:
- Current: ~1000ms (sequential)
- Improved: ~200ms (parallel)
- Speedup: 5x faster

ğŸ“ Suggested Pattern:
[Show parallel implementation]

ğŸ¤” Review: Apply performance optimization?
```

### Code Organization

**Pattern Detection:**

```typescript
// ğŸŸ¡ Opportunity: Large function (>100 lines)
function processRequest(input: unknown): Result {
  // 150 lines of validation, processing, formatting
}
```

**Suggested Improvement:**

```typescript
// âœ… Extract logical components
function processRequest(input: unknown): Result {
  const validated = validateInput(input);
  const processed = processData(validated);
  return formatResult(processed);
}

private validateInput(input: unknown): ValidatedType {
  // Validation logic
}

private processData(data: ValidatedType): ProcessedData {
  // Processing logic
}

private formatResult(data: ProcessedData): Result {
  // Formatting logic
}
```

**AI Response Template:**

```
ğŸ“¦ Code Organization Suggestion

Detected: Large function (150 lines)
Suggestion: Extract into smaller, focused functions

ğŸ“ Benefits:
- Easier to test individual components
- Better code reusability
- Improved readability
- Clearer responsibility separation

ğŸ¤” Review: Refactor into smaller functions?
```

### Documentation Improvements

**Pattern Detection:**

```typescript
// ğŸŸ¡ Opportunity: Complex function without JSDoc
function analyzeDecision(options: Option[], criteria: Criterion[], weights: number[]): AnalysisResult {
  // Complex multi-criteria analysis logic
}
```

**Suggested Documentation:**

````typescript
/**
 * Performs multi-criteria decision analysis on provided options.
 *
 * Business Context: Enables structured decision-making for enterprise
 * clients using weighted criteria evaluation.
 *
 * Decision Rationale: Weighted sum approach chosen for simplicity and
 * transparency over more complex methods (AHP, TOPSIS).
 *
 * @param options - Decision alternatives to evaluate
 * @param criteria - Evaluation criteria with scoring methods
 * @param weights - Normalized weights (must sum to 1.0)
 * @returns Analysis result with scores and recommendation
 * @throws {Error} If weights don't sum to 1.0 or arrays have mismatched lengths
 *
 * @example
 * ```typescript
 * const result = analyzeDecision(
 *   [{ name: "Option A" }, { name: "Option B" }],
 *   [{ name: "Cost", evaluationMethod: "quantitative" }],
 *   [1.0]
 * );
 * ```
 */
function analyzeDecision(options: Option[], criteria: Criterion[], weights: number[]): AnalysisResult {
  // Implementation
}
````

**AI Response Template:**

```
ğŸ“– Documentation Enhancement

Detected: Complex function without JSDoc
Missing: Purpose, parameters, examples

ğŸ“ Suggested Documentation:
[Show complete JSDoc]

ğŸ’¡ Includes:
- Business context
- Decision rationale
- Parameter descriptions
- Usage example
- Error cases

ğŸ¤” Review: Add documentation?
```

## Command Templates

Ready-to-use commands for common fixes:

### Fix All Safe Issues

```sh
# Run all safe fixes
bun run format        # Format code
bun run lint --fix    # Auto-fix linting issues
bun run check         # Validate types
```

### Pre-Commit Validation

```sh
# Complete pre-commit check
bun test --coverage && \
bun run format && \
bun run lint && \
bun run check
```

### Pre-Deployment Validation

```sh
# Full deployment readiness check
cd src/<server-name>
bun test --coverage       # 80%+ required
bun run build             # Build for Workers
bunx wrangler deploy --dry-run  # Validate config
```

### Fix Specific Issues

```sh
# Fix import organization
# [AI will provide specific sed/awk commands if needed]

# Update all .js extensions
find src -name "*.ts" -exec sed -i '' 's/from "\(\..*\)"/from "\1.js"/g' {} \;

# Remove unused imports (TypeScript)
bun run check  # Shows unused imports
```

## AI Suggestion Flow

### Standard Suggestion Format

```
[Emoji] [Category] [Title]

Detected: [What was found]
[Risk/Opportunity]: [Why it matters]

ğŸ“ Suggested Fix:
[Code or command with syntax highlighting]

ğŸ’¡ Rationale:
[Why this improves velocity/quality]

ğŸ“š Reference:
[Link to relevant rule if applicable]

ğŸ¤” Review: [Question to user about applying fix]
```

### Grouping Related Fixes

When multiple related issues are detected:

```
ğŸ”§ Multiple Import Issues Detected (5 total)

Issues:
1. Missing .js extension (3 files)
2. Unused imports (2 files)
3. Import order (4 files)

ğŸ“ Batch Fix Available:
bun run format  # Fixes all automatically

Individual fixes:
[List each with line numbers]

âš¡ Quick Fix: Run formatter for all issues?
```

## Suggestion Prioritization

**Priority Levels:**

1. **Critical** (Security, Secrets, Breaking): Immediate action required
2. **High** (Tests, Type Safety, Workers Compatibility): Fix before deployment
3. **Medium** (Performance, Organization): Improve when convenient
4. **Low** (Documentation, Style): Nice to have

**AI Presentation:**

```
ğŸš¨ Critical: Hardcoded secret detected (Fix immediately)
âš ï¸ High: Missing test coverage (Fix before deploying)
ğŸ’¡ Medium: Performance optimization available (Consider applying)
ğŸ“ Low: Documentation could be enhanced (When convenient)
```

## Context-Aware Suggestions

The AI adapts suggestions based on context:

**During Active Development:**

- Focus on immediate functionality
- Suggest quick wins only
- Defer optimization suggestions

**Before Committing:**

- Emphasize tests and coverage
- Highlight linting issues
- Check formatting

**Pre-Deployment:**

- Workers compatibility checks
- Security audit
- Environment variable validation
- Performance review

**Post-Deployment:**

- Optimization opportunities
- Refactoring suggestions
- Documentation improvements

## Integration with Other Rules

Suggestions reference specialized rules when needed:

- **Type Issues** â†’ [TypeScript](mdc:.cursor/rules/typescript.mdc)
- **Test Gaps** â†’ [Testing](mdc:.cursor/rules/testing.mdc)
- **Workers Compatibility** â†’ [Workers Deployment](mdc:.cursor/rules/workers-deployment.mdc)
- **Documentation** â†’ [Documentation](mdc:.cursor/rules/documentation.mdc)
- **Security** â†’ [Enterprise Standards](mdc:.cursor/rules/enterprise-standards.mdc)

## Summary

This automation strategy:

- âœ… Suggests fixes without automatic changes
- âœ… Provides exact code/commands
- âœ… Explains rationale for each suggestion
- âœ… Groups related fixes for efficiency
- âœ… Prioritizes by impact and urgency
- âœ… Adapts to development context
- âœ… Maintains human oversight

Result: Maximum velocity with enterprise-grade quality and complete human control.
