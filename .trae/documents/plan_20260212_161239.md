# Migration Plan: Constraint Solver to Code Mode

This plan orchestrates the migration of `src/constraint-solver` from a monolithic MCP server to the modular Code Mode architecture, utilizing the `mcp-code-architect` agent as requested.

## Phase 1: Analysis and Planning
1.  **Create Migration Mapping Document**: 
    - Generate `src/constraint-solver/MIGRATION_MAP.md` detailing the mapping from the current `index.ts` to the new 3-layer architecture (`core`, `codemode`, `mcp`).
    - Identify all interfaces, logic functions, and MCP tool definitions to be moved.

## Phase 2 & 3: Architecture Transformation & Implementation
2.  **Engage `mcp-code-architect` Agent**:
    - Delegate the core migration task to the `mcp-code-architect` agent.
    - **Task**: "Migrate `src/constraint-solver` to Code Mode architecture. Split `src/index.ts` into `src/core` (logic & types), `src/codemode` (API class), and `src/mcp` (adapter & tools). Reference `src/constraint-solver/MIGRATION_MAP.md` for the exact mapping."
    - This will create the new directory structure and files (`src/core/types.ts`, `src/core/logic.ts`, `src/codemode/index.ts`, `src/mcp/server.ts`, `src/mcp/tools.ts`, `src/index.ts`).

## Phase 4: Testing and Validation
3.  **Migrate Tests**:
    - Update `src/index.test.ts` (or create new tests in `tests/`) to test the new `Code Mode` API directly, ensuring feature parity.
    - Run `bun test` to validate the migration.
4.  **Verify Performance**:
    - Ensure the new structure does not introduce regression (e.g. by running a simple benchmark script if needed).

## Phase 5: Documentation and Compliance
5.  **Update Documentation**:
    - Update `src/constraint-solver/README.md` to reflect the new API and structure.
    - Create a `MIGRATION_REPORT.md` (Audit Trail) summarizing the changes and verifying compliance with `.trae/documents/`.

## Deliverables
- [ ] `MIGRATION_MAP.md`
- [ ] Refactored Codebase (`src/core`, `src/codemode`, `src/mcp`)
- [ ] Passing Tests
- [ ] Updated `README.md`
- [ ] `MIGRATION_REPORT.md`
